<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Log Activity - Competence CRM</title>
<link rel="stylesheet" href="/assets/sidebar.css">
<link rel="stylesheet" href="/assets/styles.css">
<style>
.content{margin-left:280px;padding:24px;width:calc(100% - 280px);min-height:100vh}
.header{background:#fff;padding:20px 24px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:24px}
.header h2{font-size:26px;color:#1e293b;font-weight:700;margin:0 0 4px}
.card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:20px;padding:24px}
.form-group{margin-bottom:20px}
.form-group label{display:block;font-weight:600;color:#1e293b;margin-bottom:8px;font-size:14px}
.form-group select,.form-group textarea,.form-group input{width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:14px;transition:all .2s}
.form-group select:focus,.form-group textarea:focus,.form-group input:focus{outline:0;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}
.form-group textarea{resize:vertical;min-height:120px}
.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s;display:inline-flex;align-items:center;gap:8px}
.btn-primary{background:#3b82f6;color:#fff}
.btn-primary:hover{background:#2563eb}
.btn-secondary{background:#64748b;color:#fff}
.loading{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;align-items:center;justify-content:center}
.loading.show{display:flex}
.spinner{border:4px solid rgba(255,255,255,.2);border-top:4px solid #fff;border-radius:50%;width:50px;height:50px;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:768px){.content{margin-left:0;width:100%;padding:16px}}
</style>
</head>
<body>
<div class="loading" id="loading"><div class="spinner"></div></div>
<div id="sidebarContainer"></div>

<main class="content">
<div class="header">
<h2>Log Activity</h2>
<p>Record client interactions and outcomes</p>
</div>

<div class="card">
<form id="activityForm">
<div class="form-group">
<label for="client">Select Client *</label>
<select id="client" required>
<option value="">-- Select Client --</option>
</select>
</div>

<div class="form-group">
<label for="category">Category *</label>
<select id="category" required>
<option value="">-- Select Category --</option>
<option value="posting">Posting</option>
<option value="message">Client Message</option>
<option value="follow_up">Follow-up</option>
<option value="meeting">Meeting</option>
</select>
</div>

<div class="form-group">
<label for="outcome">Outcome *</label>
<select id="outcome" required>
<option value="">-- Select Outcome --</option>
<option value="successful">Successful Contact</option>
<option value="no_response">No Response</option>
<option value="follow_up">Follow-up Required</option>
<option value="meeting_scheduled">Meeting Scheduled</option>
<option value="deal_closed">Deal Closed</option>
</select>
</div>

<div class="form-group">
<label for="quantity">Quantity</label>
<input id="quantity" type="number" min="1" max="1000" value="1">
</div>

<div class="form-group">
<label for="notes">Notes</label>
<textarea id="notes" placeholder="Add any additional notes..." maxlength="1000"></textarea>
</div>

<div style="display:flex;gap:12px">
<button type="submit" class="btn btn-primary">Save Activity</button>
<button type="button" class="btn btn-secondary" onclick="location.href='/employee_dashboard_page/index.html'">Cancel</button>
</div>
</form>
</div>
</main>

<script src="/assets/auth.js"></script>
<script src="/assets/sidebar.js"></script>
<script>
const show=id=>document.getElementById(id)?.classList.add('show');
const hide=id=>document.getElementById(id)?.classList.remove('show');
const loadClients=async()=>{try{const data=await Auth.apiCall('/api/clients');document.getElementById('client').innerHTML='<option value="">-- Select Client --</option>'+(data.data||[]).map(c=>`<option value="${c.id}">${c.name||c.company_name||'Unknown'}</option>`).join('')}catch(e){console.error(e)}};

const submit=async(e)=>{e.preventDefault();const client=document.getElementById('client').value,category=document.getElementById('category').value,outcome=document.getElementById('outcome').value,quantity=Number(document.getElementById('quantity').value||1),notes=document.getElementById('notes').value;if(!client||!category||!outcome)return alert('Please fill required fields');try{show('loading');await Auth.apiCall('/api/activity-log',{method:'POST',body:JSON.stringify({client_id:client,outcome,notes,category,quantity})});alert('Activity logged successfully');document.getElementById('activityForm').reset();setTimeout(()=>location.href='/employee_dashboard_page/index.html',1000)}catch(e){alert('Failed to log activity: '+e.message)}finally{hide('loading')}};

document.getElementById('activityForm').addEventListener('submit',submit);(async()=>{const user=await Auth.checkAuth();if(!user)return;Sidebar.init(user.role||'employee','activity');await loadClients()})();
</script>
</body>
</html>
