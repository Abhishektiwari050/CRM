<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reports - Competence Consulting E-commerce LLP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f8f9fa;color:#212529}.wrapper{display:flex;min-height:100vh}.sidebar{width:260px;background:linear-gradient(180deg,#6366f1 0%,#8b5cf6 100%);color:#fff;position:fixed;height:100vh;overflow-y:auto;z-index:1000;box-shadow:2px 0 10px rgba(0,0,0,.1);transition:transform .3s}.sidebar-header{padding:24px 20px;text-align:center;border-bottom:1px solid rgba(255,255,255,.15)}.sidebar-header img{width:56px;height:56px;margin:0 auto 12px;border-radius:8px;object-fit:contain;background:#fff;padding:4px}.sidebar-header h4{font-size:14px;font-weight:700;margin-bottom:4px;line-height:1.3}.sidebar-header .role{font-size:11px;color:rgba(255,255,255,.7);text-transform:uppercase;letter-spacing:.5px}.sidebar-nav{padding:16px 0}.sidebar-nav a{display:flex;align-items:center;padding:12px 20px;color:rgba(255,255,255,.85);text-decoration:none;transition:all .2s;position:relative;font-size:14px}.sidebar-nav a:hover{background:rgba(255,255,255,.1);color:#fff}.sidebar-nav a.active{background:rgba(255,255,255,.15);color:#fff;font-weight:600}.sidebar-nav a.active::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:#a78bfa}.sidebar-nav a i{width:20px;margin-right:12px;font-size:16px}.nav-divider{height:1px;background:rgba(255,255,255,.1);margin:12px 20px}.content{margin-left:260px;flex:1;padding:24px;width:calc(100% - 260px)}.header{background:#fff;padding:20px 24px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:24px;display:flex;justify-content:space-between;align-items:center}.header h2{font-size:26px;color:#1e293b;font-weight:700;margin:0}.card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:20px;overflow:hidden}.card-header{padding:20px 24px;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center;background:#fafbfc}.card-header h5{font-size:18px;color:#1e293b;margin:0;font-weight:700}.card-body{padding:24px}.filter-group{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap}.filter-group input,.filter-group select{padding:10px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:14px}.table-responsive{overflow-x:auto;border-radius:8px;border:1px solid #f1f5f9}table{width:100%;border-collapse:collapse;font-size:14px}thead{background:#f8fafc}th{padding:14px 16px;text-align:left;font-weight:700;color:#475569;font-size:12px;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}td{padding:14px 16px;border-bottom:1px solid #f1f5f9;color:#334155}tbody tr{transition:background .15s}tbody tr:hover{background:#f8fafc}tbody tr:last-child td{border-bottom:0}.btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all .2s;display:inline-flex;align-items:center;gap:8px}.btn-primary{background:#6366f1;color:#fff}.btn-primary:hover{background:#4f46e5}.btn-success{background:#10b981;color:#fff}.btn-success:hover{background:#059669}.btn-sm{padding:7px 14px;font-size:13px}.loading{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;align-items:center;justify-content:center;backdrop-filter:blur(2px)}.loading.show{display:flex}.spinner{border:4px solid rgba(255,255,255,.2);border-top:4px solid #fff;border-radius:50%;width:50px;height:50px;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.empty-state{text-align:center;padding:60px 20px;color:#94a3b8}.empty-state i{font-size:56px;margin-bottom:16px;opacity:.4}.mobile-toggle{display:none;position:fixed;top:16px;left:16px;z-index:1001;background:#6366f1;color:#fff;border:none;padding:12px 16px;border-radius:8px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.15)}.pattern-badge{background:#fef3c7;color:#92400e;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600;margin-left:8px}@media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.content{margin-left:0;padding:16px;width:100%}.mobile-toggle{display:block}table{font-size:12px}th,td{padding:10px 8px}}
</style>
</head>
<body>
<div class="loading" id="loading"><div class="spinner"></div></div>
<button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')"><i class="fas fa-bars"></i></button>

<div class="wrapper">
<aside class="sidebar" id="sidebar">
<div class="sidebar-header">
<img src="/static/images/logo.png" alt="Competence Consulting E-commerce LLP" class="brand-logo">
<h4 class="brand-name">Competence Consulting E-commerce LLP</h4>
<div class="role">Manager Portal</div>
</div>
<nav class="sidebar-nav">
<a href="/manager_dashboard_page/code.html"><i class="fas fa-chart-line"></i>Dashboard</a>
<a href="/management_page/code.html"><i class="fas fa-users"></i>All Clients</a>
<a href="/notifications_page/code.html"><i class="fas fa-bell"></i>Notifications</a>
<a href="/reports_page/code.html" class="active"><i class="fas fa-file-alt"></i>Reports</a>
<div class="nav-divider"></div>
<a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i>Logout</a>
</nav>
</aside>

<main class="content">
<div class="header">
<h2>Daily Work Reports</h2>
<button class="btn btn-success" onclick="exportReports()"><i class="fas fa-download"></i>Export</button>
</div>

<div class="card">
<div class="card-header">
<h5><i class="fas fa-chart-bar"></i>Team Reports & Pattern Analysis</h5>
<button class="btn btn-sm btn-primary" onclick="loadReports()"><i class="fas fa-sync"></i>Refresh</button>
</div>
<div class="card-body">
<div class="filter-group">
<input type="date" id="fromDate" placeholder="From Date" max="9999-12-31">
<input type="date" id="toDate" placeholder="To Date" max="9999-12-31">
<select id="employeeFilter">
<option value="">All Employees</option>
</select>
<button class="btn btn-sm btn-primary" onclick="loadReports()"><i class="fas fa-filter"></i>Filter</button>
</div>
<div id="patternsAlert" style="margin-bottom:20px"></div>
<div class="table-responsive">
<table>
<thead>
<tr>
<th>Date</th>
<th>Employee</th>
<th>Tasks</th>
<th>Achievements</th>
<th>Challenges</th>
<th>Pattern</th>
</tr>
</thead>
<tbody id="reportsBody">
<tr><td colspan="6" class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Loading...</p></td></tr>
</tbody>
</table>
</div>
</div>
</div>
</main>
</div>

<script src="/static/js/branding.js"></script>
<script src="/static/js/analytics.js"></script>
<script>
const API=window.location.origin,show=id=>document.getElementById(id).classList.add('show'),hide=id=>document.getElementById(id).classList.remove('show'),logout=()=>{localStorage.clear();sessionStorage.clear();location.href='../login_page/code.html'},auth=async()=>{try{const u=sessionStorage.getItem('currentUser');if(!u)return location.href='../login_page/code.html',null;const d=JSON.parse(u);if(d.role!=='manager'&&d.role!=='admin')return location.href='../employee_dashboard_page/code.html',null;return d}catch(e){return location.href='../login_page/code.html',null}};let allReports=[],patterns=[];const renderReports=r=>{const b=document.getElementById('reportsBody');if(!r||!r.length)return b.innerHTML='<tr><td colspan="6" class="empty-state"><i class="fas fa-inbox"></i><p>No reports</p></td></tr>';b.innerHTML=r.map(i=>{const hasPattern=patterns.find(p=>p.employee===i.employee_name);return`<tr><td>${i.date||new Date(i.submitted_at).toLocaleDateString()}</td><td><strong>${i.employee_name}</strong></td><td>${(i.tasks||'').substring(0,80)}...</td><td>${(i.achievements||'').substring(0,80)}...</td><td>${(i.challenges||'').substring(0,80)}...</td><td>${hasPattern?`<span class="pattern-badge"><i class="fas fa-exclamation-triangle"></i> Repetitive</span>`:''}</td></tr>`}).join('')},showPatterns=p=>{const a=document.getElementById('patternsAlert');if(!p||!p.length)return a.innerHTML='';const html=`<div style="background:#fef3c7;border-left:4px solid #f59e0b;padding:16px;border-radius:8px"><h4 style="color:#92400e;margin-bottom:12px"><i class="fas fa-exclamation-triangle"></i> Pattern Detection Alert</h4><p style="color:#854d0e;margin-bottom:12px">Detected ${p.length} repetitive work patterns:</p><ul style="color:#854d0e;margin-left:20px">${p.map(i=>`<li><strong>${i.employee}</strong>: "${i.pattern}..." (${i.count} occurrences)</li>`).join('')}</ul></div>`;a.innerHTML=html},loadReports=async()=>{try{show('loading');const t=localStorage.getItem('token'),f=document.getElementById('fromDate').value,to=document.getElementById('toDate').value,e=document.getElementById('employeeFilter').value;let url=`${API}/api/daily-reports?limit=100`;if(f)url+=`&from_date=${f}`;if(e)url+=`&employee_id=${e}`;const r=await fetch(url,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error('Failed');const d=await r.json();allReports=d.data||[];patterns=Analytics.detectPatterns(allReports);renderReports(allReports);showPatterns(patterns)}catch(err){console.error(err);document.getElementById('reportsBody').innerHTML='<tr><td colspan="6" class="empty-state"><i class="fas fa-exclamation-circle"></i><p>Error loading</p></td></tr>'}finally{hide('loading')}},loadEmployees=async()=>{try{const t=localStorage.getItem('token'),r=await fetch(`${API}/api/users`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)return;const d=await r.json(),s=document.getElementById('employeeFilter');s.innerHTML='<option value="">All Employees</option>'+d.data.filter(u=>u.role==='employee').map(u=>`<option value="${u.id}">${u.name}</option>`).join('')}catch(e){console.error(e)}},exportReports=()=>{const f=document.getElementById('fromDate').value;let url=`${API}/api/export/reports`;if(f)url+=`?from_date=${f}`;window.open(url,'_blank')};window.loadReports=loadReports;window.exportReports=exportReports;document.addEventListener('DOMContentLoaded',async()=>{if(await auth()){await loadEmployees();await loadReports()}});
</script>
</body>
</html>
