<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notifications - Competence CRM</title>
<link rel="stylesheet" href="/assets/sidebar.css">
<link rel="stylesheet" href="/assets/styles.css">
<style>
.content{margin-left:280px;padding:24px;width:calc(100% - 280px);min-height:100vh}
.header{background:#fff;padding:20px 24px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:24px}
.header h2{font-size:26px;color:#1e293b;font-weight:700;margin:0 0 4px}
.card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:20px;padding:24px}
.notif-item{padding:16px;border-bottom:1px solid #f1f5f9;display:flex;gap:16px;align-items:start}
.notif-item:last-child{border-bottom:none}
.notif-icon{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.notif-content{flex:1}
.notif-content h4{font-size:14px;font-weight:600;margin:0 0 4px;color:#1e293b}
.notif-content p{font-size:13px;color:#64748b;margin:0}
.notif-time{font-size:12px;color:#94a3b8;margin-top:4px}
.empty{text-align:center;padding:60px 20px;color:#94a3b8}
.loading{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;align-items:center;justify-content:center}
.loading.show{display:flex}
.spinner{border:4px solid rgba(255,255,255,.2);border-top:4px solid #fff;border-radius:50%;width:50px;height:50px;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:768px){.content{margin-left:0;width:100%;padding:16px}}
</style>
</head>
<body>
<div class="loading" id="loading"><div class="spinner"></div></div>
<div id="sidebarContainer"></div>

<main class="content">
<div class="header">
<h2>Notifications & Reminders</h2>
<p>Stay updated with client reminders</p>
</div>

<div class="card" id="notificationsContainer">
<div class="empty">
<svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg>
<p>No notifications</p>
</div>
</div>
</main>

<script src="/assets/auth.js"></script>
<script src="/assets/sidebar.js"></script>
<script>
const show=id=>document.getElementById(id)?.classList.add('show');
const hide=id=>document.getElementById(id)?.classList.remove('show');
const days=d=>{if(!d)return 999;return Math.ceil((new Date()-new Date(d))/864e5)};
const load=async()=>{try{show('loading');const data=await Auth.apiCall('/api/clients'),overdue=(data.data||[]).filter(c=>{const dy=days(c.last_contact_date);return dy>14||dy===999}),container=document.getElementById('notificationsContainer');if(!overdue.length){container.innerHTML='<div class="empty"><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg><p>No notifications</p></div>';return}container.innerHTML=overdue.map(c=>{const dy=days(c.last_contact_date);return`<div class="notif-item"><div class="notif-icon" style="background:#fee2e2;color:#ef4444"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div><div class="notif-content"><h4>${c.name||'Unknown Client'}</h4><p>${c.contact_info?.email||c.contact_email||'No contact info'}</p><div class="notif-time">${dy===999?'Never contacted':'Last contact: '+dy+' days ago'}</div></div></div>`}).join('')}catch(e){console.error(e)}finally{hide('loading')}};
(async()=>{const user=await Auth.checkAuth();if(!user)return;Sidebar.init(user.role||'employee','notifications');await load()})();
</script>
</body>
</html>
